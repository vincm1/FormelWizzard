{% extends "layout.html" %}{% block content %}
	<section class="home">
		<section class="dashboard ms-3">
			<div class="container-fluid mt-3">

				{% if not current_user.premium %}
					<div class="d-flex flex-row mb-5">
						<div class="banner col-xl-8 text-center me-4">
							<h3>{{current_user.num_prompts}} von 5 KI-Anfragen verbraucht</h3>
						</div>
						<div class="banner col-xl-3 text-center mx-3" id="premium-div">
							<a href="{{url_for('dashboard.premium')}}">
								<button class="btn btn-primary" id="premium-btn">
									<i class='bx bx-diamond icon pe-3'></i>
									Premium
								</button>
							</a>
						</div>				
					</div>
				{% endif %}

				<div class="explanation col-xl-10 mb-5">
					<h5>
						Konvertieren Sie jede Textanforderung in Excel- oder Google Sheets-Formeln 
						mit unserer AI. Geben Sie eine detaillierte <br> Beschreibung des Befehls ein, 
						den Sie benötigen, und unsere KI wird sie innerhalb von Sekunden erstellen.
					</h5>
					
					<p class="pt-3">
						*Wenn Sie falsche Ergebnisse erhalten, melden Sie diese bitte, 
						damit wir unser KI-Modell verbessern können.
					</p>
					<hr>
				</div>
				
				{% if current_user.premium or current_user.num_prompts < 5%}
					<!-- Prompt Field -->
					<div class="row justify-content-start">
						<form method="POST">
							{{form.hidden_tag()}}
						<div class="select" role="group">
							{{form.excel_google(class_="col-3 my-2 px-4")}}
						</div>
						<div class="select" role="group">
							{{form.info_prompt(class_="col-3 my-2 px-4")}}
						</div>
						<div class="select" role="group">
							{{form.formula_explain(class_="col-3 my-2 px-4")}}
						</div>
					</div>

					<div class="row prompt mt-5">
						<div class="col-xl-5 col-lg-5 col-md-3 me-5 prompt">
							{{form.prompt(class="form-control", placeholder="Schreibe mir eine Formel die zwei Zellen summiert z.B.")}}	
							<div class="row justify-content-end">
								{{form.submit(class="btn btn-primary col-4 mt-3", id="formel-btn")}}
							</div>
						</form>
						</div>

						{% if form.formula_explain.data == "Erklären" %}
						<!-- Erklärung -->
						<div class="col-xl-6 col-lg-6 col-md-3 pl-5 formula">
							<div class="card">
								<div class="card-header">
							  		Erklärung
								</div>
								<div class="card-body p-3">
									<div class="row">
										<p id="copy-target">{{explanation}}</p>
									</div>
								<div class="row d-flex justify-content-end">
									<form method="POST" action="{{url_for('dashboard.add_favorite')}}">
										{{form_2.csrf_token}}
										{{form_2.provider(value=form.excel_google.data)}}
										{{form_2.favorite_type(value=form.info_prompt.data)}}
										{{form_2.method(value=form.formula_explain.data)}}
										{{form_2.command(value=form.prompt.data)}}
										{% if form.formula_explain.data == "Erklären" %}
											{{form_2.prompt(value=explanation)}}
											<button class="p-2 btn btn-primary" type="submit" name="favorite-btn" id="favorite-btn">
												<i class="fa-regular fa-heart"></i> Favorit
											</button>
										{% endif %}
									</form>
										<div class="row d-flex">
											<button class="p-2 btn btn-primary" onclick="copyToClipboard()" id="copy-btn">
												<i class="fa-solid fa-copy"></i> Kopieren
											</button>
											<button class="p-2 btn btn-danger" id="incorrect-btn">
												<i class="fa-solid fa-circle-xmark"></i> Falsch
											</button>
										</div>
								</div>
								</div>
							</div>
						</div>
					<!-- Erklärung End -->

					{% elif form.formula_explain.data == "Erstellen" %}
					<!-- Formel -->
						<div class="col-xl-6 col-lg-6 col-md-3 ms-5 formula">
							<div class="card">
								<div class="card-header">
								Formel
								</div>
								<div class="card-body p-3">
									<div class="row">
										<p id="copy-target">{{formula}}</p>
									</div>
									<hr>
									<div class="row d-flex justify-content-end">
										<form method="POST" action="{{url_for('dashboard.add_favorite')}}">
											{{form_2.csrf_token}}
											{{form_2.provider(value=form.excel_google.data)}}
											{{form_2.favorite_type(value=form.info_prompt.data)}}
											{{form_2.method(value=form.formula_explain.data)}}
											{{form_2.command(value=form.prompt.data)}}
											{% if form.formula_explain.data == "Erstellen" %}
												{{form_2.prompt(value=formula)}}
												<button class="p-2 btn btn-primary me-2 pe-4 align-items-center" type="submit" name="favorite-btn" id="favorite-btn">
													<i class="fa-regular fa-heart ps-2 pe-1"></i> Favorit
												</button>
												<button class="p-2 btn btn-primary me-2 pe-4 align-items-center" onclick="copyToClipboard()" id="copy-btn">
													<i class="fa-solid fa-copy ps-2 pe-1"></i> Kopieren
												</button>
												<button class="p-2 btn btn-danger me-2 pe-4 align-item-center" id="incorrect-btn">
													<i class="fa-solid fa-circle-xmark ps-2 pe-1"></i> Falsch
												</button>
											{% endif %}
										</form>
									</div>
								</div>
							</div>
						</div>	
					<!-- Formel End-->	
					
					{% else %}
						<!-- Unsubmitted -->
						<div class="col-xl-6 col-lg-3 col-md-3 pl-5 formula">
							<div class="card">
								<div class="card-header">
								Formel / Erklärung
								</div>
								<div class="card-body p-3">
									<div class="row">
										<p>Lass dir eine Formel erstellen oder Erklären.</p>
									</div>
								</div>
							</div>
						</div>
						<!-- Unsubmitted End-->

					{% endif %}

					</div>
						
					<!-- Prompt Field End-->

					
								
							</div>
						<div>
					</div>

				{% else %}

				<div class="banner col-xl-10 mb-5">
					<h3>Keine Anfragen mehr übrig</h3>
					<button class="btn btn-primary premium-btn"><i class='bx bx-diamond icon'></i>Premium</button>
				</div>

				{% endif %}
						
					</div>
				</div>
		</section>
	</section>
{% endblock %}