{% extends "layout.html" %}{% block content %}
	<section class="home">
		<section class="dashboard">
			<div class="container-fluid mt-3 mx-2">

				{% if not current_user.premium %}
				<div class="banner col-xl-10 mb-5">
					<h3>{{current_user.num_prompts}} von 5 Anfragen verbraucht</h3>
					<button class="btn btn-primary premium-btn"><i class='bx bx-diamond icon'></i>Premium</button>
				</div>
				{% endif %}

				<div class="explanation col-xl-8">
					<h6>
						Konvertieren Sie jeden Text in Excel- oder Google Sheets-Formeln 
						mit AI. Geben Sie eine detaillierte Beschreibung der Formel ein, 
						die Sie benötigen, und unsere KI wird sie innerhalb von Sekunden erstellen.
					</h6>
					
					<p>
						*Wenn Sie falsche Ergebnisse erhalten, melden Sie diese bitte, 
						damit wir unser KI-Modell verbessern können.
					</p>
					<hr>
				</div>
				
				{% if current_user.premium or current_user.num_prompts < 5%}
				<div class="prompt mt-5">
					<!-- Prompt Field -->
					<div class="row align-items start">
						<form method="POST">
							{{form.hidden_tag()}}
							<div class="d-flex flex-row align-items-start">
								<div class="p-2 select" role="group">
									{{form.excel_google()}}
								</div>
								<div class="p-2 select" role="group">
									{{form.info_prompt()}}
								</div>
								<div class="p-2 select" role="group">
									{{form.formula_explain()}}
								</div>
							</div>
	
			<div class="row d-flex mt-5">

						<div class="col-xl-5 col-lg-4 col-md-3 prompt">
							<div class="row">
								{{form.prompt(class="form-control", placeholder="Schreibe mir eine Formel die zwei Zellen summiert z.B.")}}
							</div>
							<div class="row justify-content-end">
								{{form.submit(class="btn btn-primary mt-2 col-lg-5", id="formel-btn")}}
							</div>
						</form>
					</div>
					<!-- Prompt Field End-->

					{% if form.formula_explain.data == "Erklären" %}
					<!-- Erklärung -->
					<div class="col-xl-6 col-lg-3 col-md-3 pl-5 formula">
						<div class="card">
							<div class="card-header">
							  Erklärung
							</div>
							<div class="card-body p-3">
								<div class="row">
									<p id="copy-target">{{explanation}}</p>
								</div>
								<div class="row d-flex justify-content-end">
									<form method="POST" action="{{url_for('dashboard.add_favorite')}}">
										{{form_2.csrf_token}}
										{{form_2.provider(value=form.excel_google.data)}}
										{{form_2.favorite_type(value=form.info_prompt.data)}}
										{{form_2.method(value=form.formula_explain.data)}}
										{{form_2.command(value=form.prompt.data)}}
										{% if form.formula_explain.data == "Erklären" %}
											{{form_2.prompt(value=explanation)}}
											<button class="p-2 btn btn-primary" type="submit" name="favorite-btn" id="favorite-btn">
												<i class="fa-regular fa-heart"></i> Favorit
											</button>
										{% endif %}
									</form>
										<div class="row d-flex">
											<button class="p-2 btn btn-primary" onclick="copyToClipboard()" id="copy-btn">
												<i class="fa-solid fa-copy"></i> Kopieren
											</button>
											<button class="p-2 btn btn-danger" id="incorrect-btn">
												<i class="fa-solid fa-circle-xmark"></i> Falsch
											</button>
										</div>
								</div>
							</div>
						</div>
					</div>
					<!-- Erklärung End -->

					{% elif form.formula_explain.data == "Erstellen" %}
					<!-- Formel -->
						<div class="col-xl-6 col-lg-3 col-md-3 pl-5 formula">
							<div class="card">
								<div class="card-header">
								Formel
								</div>
								<div class="card-body p-3">
									<div class="row">
										<p id="copy-target">{{formula}}</p>
									</div>
									<hr>
									<div class="row d-flex justify-content-end">
										<form method="POST" action="{{url_for('dashboard.add_favorite')}}">
											{{form_2.csrf_token}}
											{{form_2.provider(value=form.excel_google.data)}}
											{{form_2.favorite_type(value=form.info_prompt.data)}}
											{{form_2.method(value=form.formula_explain.data)}}
											{{form_2.command(value=form.prompt.data)}}
											{% if form.formula_explain.data == "Erstellen" %}
												{{form_2.prompt(value=formula)}}
												<button class="p-2 btn btn-primary me-2 pe-4 align-items-center" type="submit" name="favorite-btn" id="favorite-btn">
													<i class="fa-regular fa-heart ps-2 pe-1"></i> Favorit
												</button>
												<button class="p-2 btn btn-primary me-2 pe-4 align-items-center" onclick="copyToClipboard()" id="copy-btn">
													<i class="fa-solid fa-copy ps-2 pe-1"></i> Kopieren
												</button>
												<button class="p-2 btn btn-danger me-2 pe-4 align-item-center" id="incorrect-btn">
													<i class="fa-solid fa-circle-xmark ps-2 pe-1"></i> Falsch
												</button>
											{% endif %}
										</form>
									</div>
								</div>
							</div>
						</div>	
					<!-- Formel End-->	
					
					{% else %}
						<!-- Unsubmitted -->
						<div class="col-xl-6 col-lg-3 col-md-3 pl-5 formula">
							<div class="card">
								<div class="card-header">
								Formel / Erklärung
								</div>
								<div class="card-body p-3">
									<div class="row">
										<p>Lass dir eine Formel erstellen oder Erklären.</p>
									</div>
								</div>
							</div>
						</div>
						<!-- Unsubmitted End-->

					{% endif %}
								
							</div>
						<div>
					</div>

				{% else %}

				<div class="banner col-xl-10 mb-5">
					<h3>Keine Anfragen mehr übrig</h3>
					<button class="btn btn-primary premium-btn"><i class='bx bx-diamond icon'></i>Premium</button>
				</div>

				{% endif %}
						
					</div>
				</div>
		</section>
	</section>
{% endblock %}